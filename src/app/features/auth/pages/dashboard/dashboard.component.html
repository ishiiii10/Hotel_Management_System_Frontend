<header class="header">
  <div class="header-content">
    <div class="logo">BELLE VUE</div>
    <nav class="nav">
      <a routerLink="/" class="nav-item">Home</a>
      
      <button class="nav-item logout-btn" (click)="logout()">Logout</button>
    </nav>
  </div>
</header>

<div class="container">
  <div class="page-header">
    <h1 class="page-title">My Dashboard</h1>
  </div>

  <div class="tabs">
    <div class="tab" [class.active]="activeTab === 'profile'" (click)="setTab('profile')">Profile</div>
    <div class="tab" [class.active]="activeTab === 'bookings'" (click)="setTab('bookings')">My Bookings</div>
    <div class="tab" [class.active]="activeTab === 'password'" (click)="setTab('password')">Change Password</div>
  </div>

  <!-- Profile Tab -->
  <div class="tab-content" *ngIf="activeTab === 'profile'">
    <div *ngIf="isLoading" class="loading-message">Loading profile...</div>
    <div class="profile-card" *ngIf="!isLoading && user">
      <div class="profile-header">
        <h2 class="section-title">Profile Information</h2>
      </div>
      <div class="profile-content">
        <div class="profile-field">
          <div class="field-label">Full Name</div>
          <div class="field-value">{{ user.fullName }}</div>
        </div>
        <div class="profile-field">
          <div class="field-label">Username</div>
          <div class="field-value">{{ user.username }}</div>
        </div>
        <div class="profile-field">
          <div class="field-label">Email</div>
          <div class="field-value">{{ user.email }}</div>
        </div>
        <div class="profile-field">
          <div class="field-label">Role</div>
          <div class="field-value">{{ user.role }}</div>
        </div>
        <div class="profile-field">
          <div class="field-label">Account Status</div>
          <div class="field-value" [class.enabled]="user.enabled" [class.disabled]="!user.enabled">
            {{ user.enabled ? 'Active' : 'Inactive' }}
          </div>
        </div>
        <div class="profile-field">
          <div class="field-label">User ID</div>
          <div class="field-value">{{ user.publicUserId }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bookings Tab -->
  <div class="tab-content" *ngIf="activeTab === 'bookings'">
    <div class="booking-tabs">
      <div class="booking-tab" [class.active]="bookingTab === 'all'" (click)="setBookingTab('all')">All Bookings</div>
      <div class="booking-tab" [class.active]="bookingTab === 'upcoming'" (click)="setBookingTab('upcoming')">Upcoming</div>
      <div class="booking-tab" [class.active]="bookingTab === 'past'" (click)="setBookingTab('past')">Past</div>
      <div class="booking-tab" [class.active]="bookingTab === 'cancelled'" (click)="setBookingTab('cancelled')">Cancelled</div>
    </div>

    <div *ngIf="isLoadingBookings" class="loading-message">Loading bookings...</div>
    <div *ngIf="!isLoadingBookings && getFilteredBookings().length === 0" class="empty-state">
      <div class="empty-title">No Bookings Found</div>
      <div class="empty-text">You don't have any bookings in this category</div>
      <button class="empty-btn" routerLink="/">Search Hotels</button>
    </div>

    <div *ngIf="!isLoadingBookings && getFilteredBookings().length > 0">
      <div class="booking-card" *ngFor="let booking of getFilteredBookings()">
        <div class="booking-header">
          <div class="booking-id">Booking #{{ booking.id }}</div>
          <div class="booking-status" [ngClass]="getStatusClass(booking.status)">
            {{ booking.status }}
          </div>
        </div>
        <div class="booking-content">
          <div class="booking-details">
            <div class="detail-row">
              <div class="detail-label">Hotel</div>
              <div class="detail-value">Hotel ID: {{ booking.hotelId }}</div>
            </div>
            <div class="detail-row">
              <div class="detail-label">Room</div>
              <div class="detail-value">{{ booking.roomNumber }} - {{ booking.roomType }}</div>
            </div>
            <div class="detail-row">
              <div class="detail-label">Check In</div>
              <div class="detail-value">{{ formatDate(booking.checkInDate) }}</div>
            </div>
            <div class="detail-row">
              <div class="detail-label">Check Out</div>
              <div class="detail-value">{{ formatDate(booking.checkOutDate) }}</div>
            </div>
            <div class="detail-row">
              <div class="detail-label">Guests</div>
              <div class="detail-value">{{ booking.numberOfGuests }} {{ booking.numberOfGuests === 1 ? 'Guest' : 'Guests' }}</div>
            </div>
            <div class="detail-row">
              <div class="detail-label">Total Amount</div>
              <div class="detail-value">{{ formatCurrency(booking.totalAmount) }}</div>
            </div>
          </div>
          <img *ngIf="getHotelImage(booking.hotelId)" [src]="getHotelImage(booking.hotelId)" [alt]="'Hotel ' + booking.hotelId" class="booking-image">
          <div *ngIf="!getHotelImage(booking.hotelId)" class="booking-image booking-image-placeholder">Hotel Image</div>
        </div>
        <div class="booking-actions">
          <button type="button" class="action-btn" (click)="viewBookingDetails(booking)">View Details</button>
          <button 
            class="action-btn" 
            *ngIf="booking.status === 'CONFIRMED' || booking.status === 'CREATED'"
            (click)="cancelBooking(booking)">
            Cancel Booking
          </button>
          <button 
            class="action-btn btn-view-bill" 
            *ngIf="booking.status !== 'CANCELLED'"
            (click)="openBillModal(booking.id)">
            View Bill
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Change Password Tab -->
  <div class="tab-content" *ngIf="activeTab === 'password'">
    <div class="password-card">
      <div class="password-header">
        <h2 class="section-title">Change Password</h2>
      </div>
      <div class="password-form">
        <div class="form-group">
          <label class="form-label">Current Password</label>
          <input 
            type="password" 
            class="form-input" 
            [(ngModel)]="passwordForm.currentPassword"
            placeholder="Enter current password">
        </div>
        <div class="form-group">
          <label class="form-label">New Password</label>
          <input 
            type="password" 
            class="form-input" 
            [(ngModel)]="passwordForm.newPassword"
            placeholder="Enter new password">
          <div class="form-hint">Password must be at least 8 characters and contain uppercase, lowercase, digit and special character</div>
        </div>
        <div class="form-group">
          <label class="form-label">Confirm New Password</label>
          <input 
            type="password" 
            class="form-input" 
            [(ngModel)]="passwordForm.confirmPassword"
            placeholder="Confirm new password">
        </div>
        <div class="error-message" *ngIf="passwordError">{{ passwordError }}</div>
        <div class="success-message" *ngIf="passwordSuccess">{{ passwordSuccess }}</div>
        <button 
          class="submit-btn" 
          (click)="onChangePassword()" 
          [disabled]="isChangingPassword">
          {{ isChangingPassword ? 'Changing Password...' : 'Change Password' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Booking Details Modal -->
<div class="modal-overlay" *ngIf="showBookingDetailsModal" (click)="closeBookingDetailsModal()">
  <div class="modal-content booking-details-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Booking Details</h2>
      <button class="close-button" (click)="closeBookingDetailsModal()">X</button>
    </div>
    <div class="modal-body">
      <div *ngIf="isLoadingBookingDetails" class="loading-message">Loading booking details...</div>
      
      <div *ngIf="!isLoadingBookingDetails && selectedBooking">
        <!-- Booking Status -->
        <div class="details-section">
          <div class="section-header">
            <h3>Booking Information</h3>
            <div class="booking-status-badge" [ngClass]="getStatusClass(selectedBooking.status)">
              {{ selectedBooking.status }}
            </div>
          </div>
          <div class="details-grid">
            <div class="detail-item">
              <div class="detail-label">Booking ID</div>
              <div class="detail-value">#{{ selectedBooking.id }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Booking Date</div>
              <div class="detail-value">{{ formatDate(selectedBooking.createdAt || '') }}</div>
            </div>
            <div class="detail-item" *ngIf="selectedBooking.numberOfNights">
              <div class="detail-label">Number of Nights</div>
              <div class="detail-value">{{ selectedBooking.numberOfNights }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Total Amount</div>
              <div class="detail-value highlight">{{ formatCurrency(selectedBooking.totalAmount) }}</div>
            </div>
          </div>
        </div>

        <!-- Hotel Information -->
        <div class="details-section" *ngIf="selectedHotel">
          <h3>Hotel Information</h3>
          <div class="hotel-info">
            <div class="hotel-image-container" *ngIf="selectedHotel.imageUrl">
              <img [src]="selectedHotel.imageUrl" [alt]="selectedHotel.name" class="hotel-image-large">
            </div>
            <div class="hotel-details">
              <div class="detail-item">
                <div class="detail-label">Hotel Name</div>
                <div class="detail-value">{{ selectedHotel.name }}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Address</div>
                <div class="detail-value">{{ selectedHotel.address }}, {{ selectedHotel.city }}, {{ selectedHotel.country }}</div>
              </div>
              <div class="detail-item" *ngIf="selectedHotel.contactNumber">
                <div class="detail-label">Contact Number</div>
                <div class="detail-value">{{ selectedHotel.contactNumber }}</div>
              </div>
              <div class="detail-item" *ngIf="selectedHotel.category">
                <div class="detail-label">Category</div>
                <div class="detail-value">{{ selectedHotel.category }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Room Information -->
        <div class="details-section">
          <h3>Room Information</h3>
          <div class="details-grid">
            <div class="detail-item">
              <div class="detail-label">Room Number</div>
              <div class="detail-value">{{ selectedBooking.roomNumber || 'N/A' }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Room Type</div>
              <div class="detail-value">{{ selectedBooking.roomType }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Check-In Date</div>
              <div class="detail-value">{{ formatDate(selectedBooking.checkInDate) }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Check-Out Date</div>
              <div class="detail-value">{{ formatDate(selectedBooking.checkOutDate) }}</div>
            </div>
          </div>
        </div>

        <!-- Guest Information -->
        <div class="details-section">
          <h3>Guest Information</h3>
          <div class="details-grid">
            <div class="detail-item" *ngIf="selectedBooking.guestName">
              <div class="detail-label">Primary Guest Name</div>
              <div class="detail-value">{{ selectedBooking.guestName }}</div>
            </div>
            <div class="detail-item" *ngIf="selectedBooking.guestEmail">
              <div class="detail-label">Email</div>
              <div class="detail-value">{{ selectedBooking.guestEmail }}</div>
            </div>
            <div class="detail-item" *ngIf="selectedBooking.guestPhone">
              <div class="detail-label">Phone Number</div>
              <div class="detail-value">{{ selectedBooking.guestPhone }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Number of Guests</div>
              <div class="detail-value">{{ selectedBooking.numberOfGuests }}</div>
            </div>
          </div>
          
          <!-- Guest Details List -->
          <div *ngIf="selectedBooking.guestDetails" class="guest-details-list">
            <h4>All Guests</h4>
            <div class="guest-list">
              <div class="guest-entry" *ngFor="let guest of parseGuestDetails(selectedBooking.guestDetails); let i = index">
                <div class="guest-number">Guest {{ i + 1 }}</div>
                <div class="guest-info">
                  <div class="guest-name">{{ guest.name }}</div>
                  <div class="guest-age">Age: {{ guest.age }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Special Requests -->
        <div class="details-section" *ngIf="selectedBooking.specialRequests">
          <h3>Special Requests</h3>
          <div class="special-requests">
            {{ selectedBooking.specialRequests }}
          </div>
        </div>

        <!-- Booking Timeline -->
        <div class="details-section">
          <h3>Booking Timeline</h3>
          <div class="timeline">
            <div class="timeline-item" *ngIf="selectedBooking.createdAt">
              <div class="timeline-date">{{ formatDate(selectedBooking.createdAt) }}</div>
              <div class="timeline-event">Booking Created</div>
            </div>
            <div class="timeline-item" *ngIf="selectedBooking.checkedInAt">
              <div class="timeline-date">{{ formatDate(selectedBooking.checkedInAt) }}</div>
              <div class="timeline-event">Checked In</div>
            </div>
            <div class="timeline-item" *ngIf="selectedBooking.checkedOutAt">
              <div class="timeline-date">{{ formatDate(selectedBooking.checkedOutAt) }}</div>
              <div class="timeline-event">Checked Out</div>
            </div>
            <div class="timeline-item" *ngIf="selectedBooking.cancelledAt">
              <div class="timeline-date">{{ formatDate(selectedBooking.cancelledAt) }}</div>
              <div class="timeline-event">Cancelled</div>
              <div class="timeline-note" *ngIf="selectedBooking.cancellationReason">
                Reason: {{ selectedBooking.cancellationReason }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeBookingDetailsModal()">Close</button>
    </div>
  </div>
</div>

<!-- Bill Modal -->
<div class="modal-overlay" *ngIf="showBillModal" (click)="closeBillModal()">
  <div class="modal-content bill-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Invoice Details</h2>
      <button class="close-button" (click)="closeBillModal()">X</button>
    </div>
    <div class="modal-body">
      <div *ngIf="isLoadingBill" class="loading-message">Loading bill...</div>
      
      <div *ngIf="!isLoadingBill && selectedBill" class="bill-content">
        <!-- Bill Header Section -->
        <div class="bill-header-section">
          <div class="bill-header-top">
            <div class="bill-number-section">
              <div class="bill-label">Invoice Number</div>
              <div class="bill-number">#{{ selectedBill.billNumber }}</div>
            </div>
            <div class="bill-status-badge" [class.pending]="selectedBill.status === 'PENDING'" [class.paid]="selectedBill.status === 'PAID'">
              <span class="status-icon" *ngIf="selectedBill.status === 'PAID'">‚úì</span>
              <span class="status-icon" *ngIf="selectedBill.status === 'PENDING'">‚è≥</span>
              {{ selectedBill.status }}
            </div>
          </div>
        </div>

        <!-- Booking Information Section -->
        <div class="bill-section">
          <h3 class="section-title">Booking Information</h3>
          <div class="bill-details-grid">
            <div class="bill-detail-item">
              <div class="bill-detail-label">Booking ID</div>
              <div class="bill-detail-value">#{{ selectedBill.bookingId }}</div>
            </div>
            <div class="bill-detail-item">
              <div class="bill-detail-label">Check-In Date</div>
              <div class="bill-detail-value">{{ formatDate(selectedBill.checkInDate) }}</div>
            </div>
            <div class="bill-detail-item">
              <div class="bill-detail-label">Check-Out Date</div>
              <div class="bill-detail-value">{{ formatDate(selectedBill.checkOutDate) }}</div>
            </div>
            <div class="bill-detail-item">
              <div class="bill-detail-label">Room ID</div>
              <div class="bill-detail-value">#{{ selectedBill.roomId }}</div>
            </div>
          </div>
        </div>

        <!-- Payment Summary Section -->
        <div class="bill-section payment-summary">
          <h3 class="section-title">Payment Summary</h3>
          <div class="payment-summary-content">
            <div class="payment-row">
              <div class="payment-label">Subtotal</div>
              <div class="payment-value">{{ formatCurrency(selectedBill.totalAmount) }}</div>
            </div>
            <div class="payment-row total-row">
              <div class="payment-label">Total Amount</div>
              <div class="payment-value total-amount">{{ formatCurrency(selectedBill.totalAmount) }}</div>
            </div>
          </div>
        </div>

        <!-- Payment Status Section -->
        <div class="bill-section" *ngIf="selectedBill.status === 'PAID'">
          <h3 class="section-title">Payment Information</h3>
          <div class="payment-info">
            <div class="payment-info-item">
              <div class="payment-info-label">Payment Status</div>
              <div class="payment-info-value paid-status">
                <span class="status-icon">‚úì</span> Paid
              </div>
            </div>
            <div class="payment-info-item" *ngIf="selectedBill.paidAt">
              <div class="payment-info-label">Paid On</div>
              <div class="payment-info-value">{{ selectedBill.paidAt | date:'fullDate' }}</div>
            </div>
            <div class="payment-info-item" *ngIf="selectedBill.paidAt">
              <div class="payment-info-label">Paid At</div>
              <div class="payment-info-value">{{ selectedBill.paidAt | date:'shortTime' }}</div>
            </div>
          </div>
        </div>

        <!-- Pending Payment Section -->
        <div class="bill-section pending-payment" *ngIf="selectedBill.status === 'PENDING'">
          <div class="pending-payment-alert">
            <div class="alert-icon">‚ö†Ô∏è</div>
            <div class="alert-content">
              <div class="alert-title">Payment Pending</div>
              <div class="alert-message">This invoice is pending payment. Please complete the payment to confirm your booking.</div>
            </div>
          </div>
        </div>

        <!-- Timeline Section -->
        <div class="bill-section">
          <h3 class="section-title">Timeline</h3>
          <div class="timeline">
            <div class="timeline-item">
              <div class="timeline-marker"></div>
              <div class="timeline-content">
                <div class="timeline-event">Invoice Generated</div>
                <div class="timeline-date">{{ selectedBill.generatedAt | date:'fullDate' }} at {{ selectedBill.generatedAt | date:'shortTime' }}</div>
              </div>
            </div>
            <div class="timeline-item" *ngIf="selectedBill.paidAt">
              <div class="timeline-marker paid"></div>
              <div class="timeline-content">
                <div class="timeline-event">Payment Completed</div>
                <div class="timeline-date">{{ selectedBill.paidAt | date:'fullDate' }} at {{ selectedBill.paidAt | date:'shortTime' }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div *ngIf="!isLoadingBill && !selectedBill" class="error-state">
        <div class="error-icon">üìÑ</div>
        <div class="error-title">Bill Not Found</div>
        <div class="error-message">Bill not found for this booking. The booking may not be confirmed yet.</div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeBillModal()">Close</button>
    </div>
  </div>
</div>

