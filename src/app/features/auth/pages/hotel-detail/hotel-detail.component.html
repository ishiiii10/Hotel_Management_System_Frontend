<header class="header">
  <div class="header-content">
    <div class="logo">BELLE VUE</div>
    <nav class="nav">
      <a routerLink="/" class="nav-item">Back to Search</a>
      <a routerLink="/my-bookings" class="nav-item" *ngIf="isAuthenticated">My Bookings</a>
    </nav>
  </div>
</header>

<div class="container">
  <div *ngIf="isLoading && !hotel" class="loading-message">Loading hotel details...</div>

  <div *ngIf="!isLoading && hotel">
    <!-- Hotel Header -->
    <section class="hotel-header">
      <h1 class="hotel-title">{{ hotel.name }}</h1>
      <div class="hotel-subtitle">{{ hotel.address }}, {{ hotel.city }}, {{ hotel.country }}</div>
      <div class="hotel-meta">
        <div class="meta-item" *ngIf="hotel.starRating">‚≠ê {{ hotel.starRating }}</div>
        <div class="meta-item">üìç {{ hotel.category }}</div>
        <div class="meta-item">üìû {{ hotel.contactNumber }}</div>
      </div>
    </section>

    <!-- Gallery -->
    <section class="gallery">
      <img *ngIf="hotel.imageUrl" [src]="hotel.imageUrl" [alt]="hotel.name" class="main-image">
      <div *ngIf="!hotel.imageUrl" class="main-image main-image-placeholder">Main Hotel Image</div>
      <div class="thumbnail-grid">
        <div class="thumbnail" *ngFor="let i of [1,2,3,4,5]">
          <img *ngIf="hotel.imageUrl" [src]="hotel.imageUrl" [alt]="hotel.name + ' thumbnail ' + i">
        </div>
      </div>
    </section>

    <!-- Content Grid -->
    <div class="content-grid">
      <!-- Main Content -->
      <div class="main-content">
        <section class="section">
          <h2 class="section-title">About</h2>
          <div class="section-content">
            {{ hotel.description || 'No description available' }}
          </div>
        </section>

        <section class="section" *ngIf="hotel.amenities">
          <h2 class="section-title">Amenities</h2>
          <div class="amenity-grid">
            <div class="amenity-item" *ngFor="let amenity of getAmenitiesList()">
              {{ amenity }}
            </div>
          </div>
        </section>

        

        <section class="rooms-list" *ngIf="availableRooms.length > 0">
          <h2 class="section-title">Available Rooms</h2>
          
          <div class="room-card" *ngFor="let room of availableRooms" [class.selected]="selectedRoom?.roomId === room.roomId">
            <div class="room-header">
              <div class="room-title">{{ room.roomType }}</div>
              <div class="room-price">{{ formatCurrency(room.pricePerNight) }}/night</div>
            </div>
            <div class="room-details">
              <div class="detail-item">üõèÔ∏è Max Occupancy: {{ room.maxOccupancy }}</div>
              <div class="detail-item">üìê Size: Standard</div>
              <div class="detail-item">üõÅ Features: {{ room.amenities || 'Standard amenities' }}</div>
            </div>
            <div class="room-description">
              {{ room.description || 'Comfortable room with all essential amenities' }}
            </div>
            <button class="select-btn" (click)="selectRoom(room)">Select Room</button>
          </div>
        </section>
      </div>

      <!-- Booking Sidebar -->
      <aside class="booking-sidebar">
        <div class="price-box" *ngIf="selectedRoom">
          <div class="price-label">Price per night</div>
          <div class="price">{{ formatCurrency(selectedRoom.pricePerNight) }}</div>
        </div>

        <div class="booking-form">
          <h3>Book Now</h3>
          
          <div class="form-group">
            <label class="form-label">Check In</label>
            <input type="date" class="form-input" [(ngModel)]="bookingForm.checkInDate" [min]="minDate">
          </div>
          
          <div class="form-group">
            <label class="form-label">Check Out</label>
            <input type="date" class="form-input" [(ngModel)]="bookingForm.checkOutDate" [min]="minCheckOutDate">
          </div>
          
          <div class="form-group">
            <label class="form-label">Guests</label>
            <input type="number" class="form-input" [(ngModel)]="bookingForm.numberOfGuests" min="1" placeholder="Number of guests">
          </div>

          <button class="btn-check-availability" (click)="onAvailabilitySearch()">Check Availability</button>
          
          <div class="price-summary" *ngIf="selectedRoom && bookingForm.checkInDate && bookingForm.checkOutDate">
            <div class="price-row">
              <span>Room price</span>
              <span>{{ formatCurrency(calculateTotal()) }}</span>
            </div>
            <div class="price-row">
              <span>Taxes</span>
              <span>{{ formatCurrency(calculateTaxes()) }}</span>
            </div>
            <div class="price-row total">
              <span>Total</span>
              <span>{{ formatCurrency(calculateGrandTotal()) }}</span>
            </div>
          </div>
          
          <button class="book-btn" (click)="onBookNow()" [disabled]="!selectedRoom || isBooking">
            {{ isBooking ? 'Booking...' : (isAuthenticated ? 'Book Now' : 'Login to Book') }}
          </button>
        </div>
      </aside>
    </div>
  </div>
</div>

<!-- Booking & Payment Modal -->
<div class="modal-overlay" *ngIf="showBookingModal" (click)="closeBookingModal()">
  <div class="modal-content booking-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Booking Confirmation & Payment</h2>
      <button class="close-button" (click)="closeBookingModal()">X</button>
    </div>
    <div class="modal-body">
      <div *ngIf="createdBooking" class="booking-confirmation">
        <div class="success-message">
          <h3>‚úÖ Booking Created Successfully!</h3>
          <p>Booking ID: <strong>{{ createdBooking.id }}</strong></p>
        </div>
      </div>

      <div *ngIf="isLoadingBill" class="loading-message">Loading bill...</div>
      
      <div *ngIf="!isLoadingBill && bill" class="bill-section">
        <div class="bill-header">
          <div class="bill-number">Bill #{{ bill.billNumber }}</div>
          <div class="bill-status" [class.pending]="bill.status === 'PENDING'" [class.paid]="bill.status === 'PAID'">
            {{ bill.status }}
          </div>
        </div>
        
        <div class="bill-info">
          <div class="info-row">
            <span class="info-label">Total Amount:</span>
            <span class="info-value">{{ formatCurrency(bill.totalAmount) }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Generated At:</span>
            <span class="info-value">{{ bill.generatedAt | date:'medium' }}</span>
          </div>
        </div>

        <div *ngIf="bill.status === 'PENDING'" class="payment-section">
          <h3>Complete Payment</h3>
          <p class="info-message">After payment, your booking will be automatically confirmed.</p>
          <form (ngSubmit)="onPayBill()">
            <div class="form-group">
              <label class="form-label">Payment Method *</label>
              <select class="form-input" [(ngModel)]="paymentForm.paymentMethod" name="paymentMethod" required>
                <option value="">Select payment method</option>
                <option value="CASH">Cash</option>
                <option value="CARD">Card</option>
                <option value="UPI">UPI</option>
                <option value="NET_BANKING">Net Banking</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Transaction ID (Optional)</label>
              <input type="text" class="form-input" [(ngModel)]="paymentForm.transactionId" name="transactionId">
            </div>
            <div class="form-group">
              <label class="form-label">Payment Reference (Optional)</label>
              <input type="text" class="form-input" [(ngModel)]="paymentForm.paymentReference" name="paymentReference">
            </div>
            <div class="form-group">
              <label class="form-label">Notes (Optional)</label>
              <textarea class="form-input" [(ngModel)]="paymentForm.notes" name="notes" rows="3"></textarea>
            </div>
            <div class="form-actions">
              <button type="button" class="btn-secondary" (click)="closeBookingModal()">Close</button>
              <button type="submit" class="btn-primary">Pay Now</button>
            </div>
          </form>
        </div>

        <div *ngIf="bill.status === 'PAID'" class="success-message">
          <p>‚úÖ Payment completed! Your booking is confirmed and ready for check-in.</p>
        </div>
      </div>
      
      <div *ngIf="!isLoadingBill && !bill" class="error-message">
        Bill not found. Please wait a moment and try again.
      </div>
    </div>
  </div>
</div>
